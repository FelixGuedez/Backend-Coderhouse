"<!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Form HBS</title>\r\n    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css\"\r\n        integrity=\"sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l\" crossorigin=\"anonymous\">\r\n    <script src=\"https://cdn.jsdelivr.net/npm/normalizr@3.6.1/dist/normalizr.browser.min.js\"></script>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"jumbotron p-0 m-2 d-flex justify-content-between\">\r\n    <h2 style=\"color: green;\">Bienvenido </h2>\r\n        <button class=\"btn btn-warning mt-1 mb-1\" onclick=\"location.href='/logout'\" type=\"submit\">Logout</button>\r\n</div>\r\n\r\n\r\n<div>\r\n    <h2 style=\"color:orange;\">Lista de Productos</h2>\r\n\r\n    <div class=\"table-responsive\">\r\n        <table class=\"table table-dark\" id=\"historial\">\r\n\r\n        </table>\r\n    </div>\r\n\r\n</div>\r\n\r\n\r\n<h3>Chat de Mensajes</h3>\r\n<h4>Compresion <span id=\"porcentajeCompresion\"></span></h4>\r\n<form>\r\n    <div class=\"form-group\">\r\n        <label for=\"email\">Email:</label>\r\n        <input type=\"email\" class=\"form-control\" id=\"email\" aria-describedby=\"userComment\">\r\n        <!-- <small id=\"userComment\" class=\"form-text text-muted\">Email que se utilizara al enviar mensajes.</small> -->\r\n        <label for=\"nombre\">Nombre:</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"nombre\" aria-describedby=\"userComment\">\r\n        <label for=\"apellido\">Apellido:</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"apellido\" aria-describedby=\"userComment\">\r\n        <label for=\"edad\">Edad:</label>\r\n        <input type=\"number\" class=\"form-control\" id=\"edad\" aria-describedby=\"userComment\">\r\n        <label for=\"alias\">Alias:</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"alias\" aria-describedby=\"userComment\">\r\n        <label for=\"avatar\">Avatar:</label>\r\n        <input type=\"text\" class=\"form-control\" id=\"avatar\" aria-describedby=\"userComment\">\r\n    </div>\r\n    <div class=\"form-group\">\r\n        <label for=\"contenidoMensaje\">Mensaje:</label>\r\n        <input class=\"form-control\" id=\"contenidoMensaje\" rows=\"3\"></input>\r\n    </div>\r\n    <button class=\"btn btn-success\" onclick=\"enviarMensaje()\">Enviar Mensaje</button>\r\n</form>\r\n<hr>\r\n<div id=\"mensajes\">\r\n    <!-- aqui se renderizan los mensajes recibidos por parte del server -->\r\n</div>\r\n    <script src=\"/socket.io/socket.io.js\"></script>\r\n    <script>\r\n\r\n        const socket = io();\r\n\r\n        socket.on('from-server-producto', productos => {\r\n            console.log('producto recibido', productos)\r\n            const htmlProductos = productos.map((item) => {\r\n                return `<tr>\r\n            <td>${item.nombre}</td>\r\n            <td>${item.precio}</td>\r\n            <td>\r\n                <img width=\"30\" src=\"${item.imagen}\" alt=\"\">\r\n            </td>\r\n        </tr>`\r\n            })\r\n\r\n            const headerTabla = ` <tr style=\"color: green;\">\r\n            <th>Producto</th>\r\n            <th>Precio</th>\r\n            <th>Imagen</th>\r\n        </tr>`\r\n\r\n            document.querySelector(\"#historial\").innerHTML = headerTabla + htmlProductos\r\n        })\r\n\r\n\r\n        function enviarProducto() {\r\n            const inputProducto = document.querySelector('#producto');\r\n            const inputPrecio = document.querySelector('#precio');\r\n            const inputImagen = document.querySelector('#imagen');\r\n\r\n            const producto = {\r\n                producto: inputProducto.value,\r\n                precio: inputPrecio.value,\r\n                imagen: inputImagen.value\r\n            }\r\n            // console.log(producto)\r\n            socket.emit('from-client-producto', producto);\r\n            console.log(producto)\r\n        }\r\n\r\n\r\n        // Desnormalizacion de Mensajes\r\n        const schemaAuthor = new normalizr.schema.Entity('author', {}, { idAttribute: 'id' })\r\n\r\n        const schemaMensaje = new normalizr.schema.Entity('post', { author: schemaAuthor }, { idAttribute: 'id' })\r\n\r\n        const schemaMensajes = new normalizr.schema.Entity('post', { author: schemaMensaje }, { idAttribute: 'id' })\r\n\r\n        socket.on('from-server-mensaje', mensajes => {\r\n\r\n            let mensajesNsize = JSON.stringify(mensajes).length\r\n            console.log(mensajes, mensajesNsize)\r\n\r\n            let mensajesD = normalizr.denormalize(mensajes.result, schemaMensajes, mensajes.entities)\r\n\r\n            let mensajesDsize = JSON.stringify(mensajesD).length\r\n            console.log(mensajesD, mensajesDsize)\r\n\r\n            let porcentajeC = parseInt((mensajesNsize * 100) / mensajesDsize)\r\n            console.log(`Porcentaje de Compresion ${porcentajeC} %`)\r\n            document.querySelector('#porcentajeCompresion').innerHTML = `${porcentajeC} %`\r\n\r\n            render(mensajes);\r\n        });\r\n\r\n        function render(mensajes) {\r\n            console.log('mensaje recibidos', mensajes)\r\n            const cuerpoMensajesHTML = mensajes.map((msj) => {\r\n                return `<span style=\"color:blue;\"><b>${msj.email} <span<span style=\"color:brown;\">[${msj.fecha}]:</span> </b><span <span style=\"color:green;\">${msj.mensaje}</span></span>`;\r\n            }).join('<br>');\r\n            console.log(cuerpoMensajesHTML);\r\n\r\n            document.querySelector('#mensajes').innerHTML = cuerpoMensajesHTML;\r\n        }\r\n\r\n        function enviarMensaje() {\r\n            const inputEmail = document.querySelector('#email');\r\n            const inputNombre = document.querySelector('#nombre')\r\n            const inputApellido = document.querySelector('#apellido')\r\n            const inputEdad = document.querySelector('#edad')\r\n            const inputAlias = document.querySelector('#alias')\r\n            const inputAvatar = document.querySelector('#avatar')\r\n            const inputContenido = document.querySelector('#contenidoMensaje');\r\n            const fecha = new Date().toLocaleString()\r\n\r\n            const mensaje = {\r\n                author: inputEmail.value,\r\n                nombre: inputNombre.value,\r\n                apellido: inputApellido.value,\r\n                edad: inputEdad.value,\r\n                alias: inputAlias.value,\r\n                avatar: inputAvatar.value,\r\n                text: inputContenido.value,\r\n                date: fecha\r\n            }\r\n            console.log(mensaje)\r\n\r\n            socket.emit('from-client-mensaje', mensaje);\r\n        }\r\n\r\n    </script>\r\n</body>\r\n\r\n</html>"